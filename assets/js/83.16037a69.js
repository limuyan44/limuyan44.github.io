(window.webpackJsonp=window.webpackJsonp||[]).push([[83],{579:function(e,t,n){"use strict";n.r(t);var s=n(6),a=Object(s.a)({},(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[n("blockquote",[n("p",[e._v("官网上生成证书的方式有很多种，正好ecs上面有git所以就采用了"),n("strong",[e._v("certbot")]),e._v("来生成")])]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("    git clone https://github.com/certbot/certbot\n    cd certbot/\n    ./certbot-auto certonly --standalone --email duanmu3209211994@163.com -d zycat.top -d www.zycat.top\n")])])]),n("p",[e._v("执行完上面之后生成的证书在【/etc/letsencrypt/】这里面，如果生成的过程中80端口报错的话是因为nginx占用了。执行【service nginx stop】关掉nginx即可。 我们用到的证书在")]),e._v(" "),n("blockquote",[n("p",[e._v("ssl_certificate /etc/letsencrypt/live/zycat.top/fullchain.pem; ssl_certificate_key /etc/letsencrypt/live/zycat.top/privkey.pem;")])]),e._v(" "),n("p",[e._v("解下来配置和nginx.conf即可 为了方便起见将原来http的server改成")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("server{\n#ssl start\n        listen 443 ssl;\n        ssl on;\n        ssl_certificate /etc/letsencrypt/live/zycat.top/fullchain.pem;\n         ssl_certificate_key /etc/letsencrypt/live/zycat.top/privkey.pem;\n        #ssl end\n    #下面还是原来的配置如\n    index index.html index.htm index.php;\n        root  /home/wwwroot/default;\n}\n")])])]),n("p",[e._v("然后再新建一个用来转发的http server,这里主要是为了全站https.")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("server\n        {\n        listen 80 default_server;\n        #listen [::]:80 default_server ipv6only=on;\n        server_name www.zycat.top;\n            return      301 https://$server_name$request_uri;\n        }\n")])])]),n("h2",{attrs:{id:"证书有效期问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#证书有效期问题"}},[e._v("#")]),e._v(" 证书有效期问题")]),e._v(" "),n("p",[e._v("官方提供的证书只有三个月的有效期，需要我们手动去重新申请证书。 这个其实也简单，重复上面的生成命令就好了。可以使用linux的定时任务去执行，执行之前最好备份一下原有的证书。不过这里的")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v("./certbot-auto certonly --renew-by-default  --email duanmu3209211994@163.com -d zycat.top -d www.zycat.top\n")])])]),n("p",[e._v("就不是_standalone_而是_renew-by-default_了。 定时任务,每5天请求一次，当发现证书有效期小于30天的时候就会去请求新的证书，而且定时任务重启机器会重新即使。使用renew-hook会在请求成功证书后重新加载nginx.否则nginx的缓存还是失效的证书。")]),e._v(" "),n("div",{staticClass:"language- extra-class"},[n("pre",[n("code",[e._v('0 * */5 * * certbot renew --quiet --renew-hook "/etc/init.d/nginx reload"  \n')])])]),n("p",[e._v("有时间讲讲linux的定时任务。")])])}),[],!1,null,null,null);t.default=a.exports}}]);